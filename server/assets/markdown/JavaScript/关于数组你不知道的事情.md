<!--
 * @Author: tianyu
 * @Date: 2023-05-10 11:07:20
 * @Description: 
-->
# 关于Array你不知道的事情

在 `javascript` 中。`Array` 在内存上分配的空间是连续的吗？

比如 `[1,2,3]` 就是连续的吗？

`Array` 又分为什么数组。是 `快数组(fast Array)` 还是 `慢数组(slow Array)` 呢？

## 数组的特殊性

在 `javascript` 中。`Array` 的长度是可以任意修改的。例如：

```js
const arr = [1, 'abc', [2]]; // * 同一个数组下的不同类型的元素。
console.log(arr.length); // * 打印 3

arr[arr.length] = 'hello';
console.log(arr.length); // * 打印 4
```

1. 同一个JS数组的元素可以是**不同的数据类型**，那么肯定没法固定长度维每个元素分配空间，那么这样的数组也就没办法通过元素的索引来计算出某个元素对应的存储地址。
2. JS数组可以**任意更改大小**，看到这里，JS数组在内存中分配的空间还是连续的吗？如果是连续的，如果无限制增加数组的大小，怎么保证后面的区域也是可以分配给数组的呢？

## 初探JS数组

在JS中数组存在两种形式，一种是与 `C/C++` 等相同的在连续内存中存放数据的**快数组**，另一种是 `HashTable` 结构的**慢数组**，是一种典型的**字典形式(字典相当于JS中的Map)**。在V8引擎中，直接创建数组默认的方式是创建**快数组**，会直接为数组开辟**一定大小连续的内存**。

例子：

第一步：打开浏览器 `Developer Tools` 的 `Memory` 选项卡，选择 `Allocation instrumentation on timeline` 然后可以产看当时我们用了多大内存。

然后在浏览器的 `Console` 中执行以下代码：

```js
const LIMIT = 6 * 1024 * 1024;
let arr = new Array(LIMIT);
```

观察 `Memory` 是否是增加了(不出意外会的)，大概增加了 `25MB` 左右。说明开辟了一块内存区域供数组使用，那我们如何知道这一块内存区域是否是连续的呢？

回想数据结构中的知识：如果系统为该数组分配的是一块连续的内存，那么在这个数组上的遍历速度应该是很快的，那么我们可以计算一下遍历数组大概需要多少时间：

```js
console.time("Array");
for(let i = 0; i < LIMIT; i++) arr[i] = i;
console.timeEnd("Array");
```

大概打印了 `10ms` 左右，现在我们知道了快数组是和 `c/c++` 等语言类似的为其分配连续固定大小的内存空间，那如果我们此时改变数组的大小，会发生什么事？

```js
arr[arr.length+1026] = 1
console.time("Array+1026");

for(let i = 0; i < LIMIT; i++) arr[i] = i; 
console.timeEnd("Array+1026");
```
